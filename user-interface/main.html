<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gaming Platform</title>
    <link rel="stylesheet" href="global.css" />
    <link rel="stylesheet" href="tournement/tournament.css" />
    <link rel="stylesheet" href="games/style.css" />
    <link rel="stylesheet" href="events/events.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body>
    <div class="app">
      <!-- Sidebar -->
      <div class="sidebar">
        <!-- User Profile Section -->
        <div class="profile">
          <div class="avatar-container">
            <img
              src="/user-interface/img/iheb.jpg"
              alt="Profile"
              class="avatar"
            />
            <div class="status-indicator"></div>
          </div>
          <h2 class="username">Elazheri Iheb</h2>
          <p class="welcome-text">Welcome back!</p>
        </div>
        <!-- Navigation -->
        <nav class="nav-menu">
          <a href="#" class="nav-item active" id="homeLink">
            <i data-lucide="home"></i>
            <span>Home</span>
            <i data-lucide="chevron-right" class="chevron"></i>
          </a>
          <a href="#games" class="nav-item" id="gamesLink">
            <i data-lucide="gamepad-2"></i>
            <span>Games</span>
            <i data-lucide="chevron-right" class="chevron"></i>
          </a>
          <a href="#tournament" class="nav-item" id="tournamentsLink">
            <i data-lucide="trophy"></i>
            <span>Tournaments</span>
            <i data-lucide="chevron-right" class="chevron"></i>
          </a>
          <a href="#" class="nav-item" id="eventsLink">
            <i data-lucide="calendar"></i>
            <span>Events</span>
            <i data-lucide="chevron-right" class="chevron"></i>
          </a>
        </nav>
        <!-- Logout Button -->
        <button class="logout-btn" onclick="handleLogout()">
          <i data-lucide="log-out"></i>
          <span>Logout</span>
        </button>
        <!-- Footer -->
        <div class="sidebar-footer">
          <p>Gaming Zone v1.0</p>
        </div>
      </div>

      <!-- Home Section -->
      <div class="main-content" id="homeSection">
        <div class="content-container">
          <h1 class="main-title">Welcome to Gaming Zone</h1>
          <div class="feature-grid">
            <div class="feature-card">
              <i data-lucide="gamepad-2"></i>
              <h3>Featured Games</h3>
              <p>Explore our collection of trending games and new releases.</p>
            </div>
            <div class="feature-card">
              <i data-lucide="users"></i>
              <h3>Active Players</h3>
              <p>Join thousands of players in exciting multiplayer matches.</p>
            </div>
            <div class="feature-card">
              <i data-lucide="flame"></i>
              <h3>Live Tournaments</h3>
              <p>Compete in tournaments and win amazing prizes.</p>
            </div>
          </div>
          <div class="cta-section">
            <h2>üéÆ Ready to Play?</h2>
            <p>
              Choose from our extensive library of games, join tournaments, or
              participate in upcoming events.
            </p>
            <div class="cta-buttons">
              <button class="btn btn-primary" id="browseGamesBtn">
                Browse Games
              </button>
              <button class="btn btn-secondary" id="viewTournamentsBtn">
                View Tournaments
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Games Section (hidden by default) -->
      <div class="main-content" id="gamesSection" style="display: none">
        <div class="content-container">
          <header>
            <h1>Games Explorer</h1>
            <div class="games-search-container">
              <input
                type="text"
                id="searchInput"
                placeholder="Search games..."
              />
              <i class="fas fa-search search-icon"></i>
            </div>
            <div class="filters">
              <select id="gamesCategoryFilter">
                <option value="">All Categories</option>
                <option value="action">Action</option>
                <option value="adventure">Adventure</option>
                <option value="rpg">RPG</option>
                <option value="sports">Sports</option>
                <option value="strategy">Strategy</option>
              </select>
              <select id="gamesRatingFilter">
                <option value="">All Ratings</option>
                <option value="5">5 Stars</option>
                <option value="4">4+ Stars</option>
                <option value="3">3+ Stars</option>
              </select>
            </div>
          </header>
          <main id="gamesGrid">
            <!-- Games will be injected here by main.js -->
          </main>
        </div>
      </div>

      <!-- Tournament Section (hidden by default) -->
      <div class="main-content" id="tournamentSection" style="display: none">
        <div class="content-container">
          <div class="tournament-h1">
            <h1 class="main-title">Available Tournaments</h1>
            <!-- Search and Filter Section -->
            <div class="tournament-search-container">
              <div class="tournament-search-bar">
                <input
                  type="text"
                  placeholder="Search tournaments..."
                  id="tournamentSearchInput"
                />
              </div>
              <div class="tournament-filter-section">
                <select id="tournamentCategoryFilter">
                  <option value="">All Categories</option>
                  <option value="fps">FPS Games</option>
                  <option value="moba">MOBA</option>
                  <option value="battle-royale">Battle Royale</option>
                  <option value="racing">Racing</option>
                  <option value="fighting">Fighting Games</option>
                </select>
              </div>
            </div>
          </div>
          <!-- Tournaments Grid -->
          <div class="tournament-grid" id="tournamentsGrid">
            <!-- Tournament cards get injected by tournament.js -->
          </div>
        </div>
      </div>
      <!-- Events Section -->
      <div class="main-content" id="eventsSection" style="display: none">
        <div class="content-container">
          <div class="events-h1">
            <h1 class="main-title">Gaming Events</h1>
            <div class="tournament-search-container">
              <div class="tournament-search-bar">
                <input
                  type="text"
                  id="eventSearchInput"
                  placeholder="Search events..."
                />
              </div>
              <div class="tournament-filter-section">
                <select id="eventCategoryFilter">
                  <option value="">All Categories</option>
                  <option value="convention">Conventions</option>
                  <option value="conference">Conference</option>
                  <option value="meetup">Meetups</option>
                  <option value="workshop">Workshops</option>
                  <option value="launch">Game Launches</option>
                </select>
                <select id="eventCountryFilter">
                  <option value="">All Countries</option>
                  <option value="usa">United States</option>
                  <option value="japan">Japan</option>
                  <option value="uk">United Kingdom</option>
                  <option value="germany">Germany</option>
                  <option value="france">France</option>
                </select>
              </div>
            </div>
          </div>
          <div class="events-grid" id="eventsGrid">
            <!-- Event cards will be injected by events.js -->
          </div>
        </div>
      </div>
    </div>

    <!-- Tournament Registration Modal -->
    <div class="tournament-modal" id="registrationModal" style="
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(8px);
    ">
      <div class="tournament-modal-content" style="
        background: linear-gradient(135deg, #1e293b, #334155);
        border-radius: 20px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        border: 1px solid #475569;
        position: relative;
      ">
        <div class="tournament-modal-header" style="
          padding: 30px 30px 20px 30px;
          border-bottom: 1px solid #475569;
          text-align: center;
        ">
          <h2 style="margin: 0; color: #f8fafc; font-size: 1.8rem; font-weight: 700; margin-bottom: 8px;">üèÜ Tournament Registration</h2>
          <p id="tournamentTitle" style="color: #94a3b8; margin: 0; font-size: 1.1rem;"></p>
          <button class="tournament-modal-close" onclick="closeModal()" style="
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #94a3b8;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
          " onmouseover="this.style.backgroundColor='#475569'; this.style.color='#ef4444'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='#94a3b8'">
            ‚úï
          </button>
        </div>
        <div class="tournament-modal-body" style="padding: 30px;">
          <form id="registrationForm" onsubmit="handleRegistration(event)">
            <div style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #e2e8f0; font-size: 0.9rem;">üë§ Your Username</label>
              <input type="text" name="username" id="regUsername" required style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #475569;
                border-radius: 12px;
                font-size: 0.9rem;
                background: #ffffff;
                color: #1e293b;
                box-sizing: border-box;
                transition: border-color 0.2s;
              " onfocus="this.style.borderColor='#3b82f6'" onblur="this.style.borderColor='#475569'" />
            </div>
            <div style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #e2e8f0; font-size: 0.9rem;">üìß Contact Email</label>
              <input type="email" id="contactEmail" name="email" required style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #475569;
                border-radius: 12px;
                font-size: 0.9rem;
                background: #ffffff;
                color: #1e293b;
                box-sizing: border-box;
                transition: border-color 0.2s;
              " onfocus="this.style.borderColor='#3b82f6'" onblur="this.style.borderColor='#475569'" />
            </div>
            <div style="margin-bottom: 30px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #e2e8f0; font-size: 0.9rem;">üèÖ Team Name</label>
              <input type="text" name="teamName" required style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #475569;
                border-radius: 12px;
                font-size: 0.9rem;
                background: #ffffff;
                color: #1e293b;
                box-sizing: border-box;
                transition: border-color 0.2s;
              " onfocus="this.style.borderColor='#3b82f6'" onblur="this.style.borderColor='#475569'" placeholder="Enter your team name" />
            </div>
            <div style="
              display: flex;
              gap: 12px;
              justify-content: flex-end;
              padding-top: 20px;
              border-top: 1px solid #475569;
            ">
              <button type="button" onclick="closeModal()" style="
                padding: 12px 24px;
                background: #475569;
                color: #e2e8f0;
                border: 2px solid #64748b;
                border-radius: 12px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s;
                font-size: 0.9rem;
              " onmouseover="this.style.backgroundColor='#64748b'" onmouseout="this.style.backgroundColor='#475569'">
                Cancel
              </button>
              <button type="submit" style="
                padding: 12px 24px;
                background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                color: white;
                border: none;
                border-radius: 12px;
                font-weight: 700;
                cursor: pointer;
                transition: all 0.2s;
                box-shadow: 0 4px 14px rgba(59, 130, 246, 0.4);
                font-size: 0.9rem;
              " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 20px rgba(59, 130, 246, 0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 14px rgba(59, 130, 246, 0.4)'">
                üéÆ Register for Tournament
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Event Registration Modal -->
    <div class="tournament-modal" id="eventRegistrationModal">
      <div class="tournament-modal-content">
        <div class="tournament-modal-header">
          <h2>Event Registration</h2>
          <button class="tournament-modal-close" onclick="closeEventModal()">
            <i data-lucide="x"></i>
          </button>
        </div>
        <div class="tournament-modal-body">
          <h3 id="eventTitle" class="tournament-item-title"></h3>
          <form
            id="eventRegistrationForm"
            onsubmit="handleEventRegistration(event)"
          >
            <div class="tournament-form-group">
              <label for="teamName">Team Name</label>
              <input type="text" id="teamName" required />
            </div>
            <div class="tournament-form-group">
              <label for="playerCount">Number of Players</label>
              <input type="number" id="playerCount" min="1" max="5" required />
            </div>
            <div class="tournament-form-group">
              <label for="contactEmail">Contact Email</label>
              <input type="email" id="contactEmail" required />
            </div>
            <div class="tournament-form-group">
              <label for="discordId">Discord ID</label>
              <input type="text" id="discordId" required />
            </div>
            <div class="tournament-form-group">
              <label for="experience">Team Experience Level</label>
              <select id="experience" required>
                <option value="">Select experience level</option>
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
                <option value="professional">Professional</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">
              Register for Event
            </button>
          </form>
        </div>
      </div>
    </div>

    <script src="main.js"></script>
    <script src="tournement/tournament.js"></script>
    <script src="games/main.js"></script>
    <script src="events/events.js"></script>
    <script>
      // Global user object - will be populated from session
      let currentUser = null;
      
      // Check authentication on page load
      document.addEventListener("DOMContentLoaded", async function () {
        console.log("üöÄ DOM fully loaded, checking authentication...");
        
        // Check if user is authenticated
        await checkAuthentication();
        
        // Clear any existing games first
        const gamesGrid = document.getElementById("gamesGrid");
        if (gamesGrid) {
          console.log("üßπ Clearing existing games grid content...");
          gamesGrid.innerHTML =
            '<div style="color: white; text-align: center; padding: 40px;">Loading games from database...</div>';
        }

        setTimeout(() => {
          console.log(
            "üéÆ Games Manager available:",
            typeof window.gamesManager
          );
          console.log("üéÆ GamesManager class available:", typeof GamesManager);

          // Test API directly first
          console.log("üß™ Testing API call...");
          fetch("http://localhost/gaming-zone/api/games.php")
            .then((response) => response.json())
            .then((data) => {
              console.log("üß™ Direct API test result:", data);

              // Force display these games
              if (Array.isArray(data) && data.length > 0) {
                console.log("‚úÖ API working, forcing display of games...");
                forceDisplayGames(data);
              } else {
                console.error("‚ùå API not returning games array");
              }
            })
            .catch((error) => {
              console.error("‚ùå API test failed:", error);
            });
        }, 1000);
      });

      // Check if user is authenticated
      async function checkAuthentication() {
        try {
          const response = await fetch('http://localhost/gaming-zone/api/auth.php', {
            method: 'GET',
            credentials: 'include' // Include session cookies
          });
          
          const authData = await response.json();
          console.log('üîê Authentication check:', authData);
          
          if (authData.authenticated) {
            currentUser = authData.user;
            console.log('‚úÖ User authenticated:', currentUser);
            
            // Update UI with user info
            document.querySelector('.username').textContent = currentUser.name;
            document.querySelector('.welcome-text').textContent = `Welcome back, ${currentUser.name.split(' ')[0]}!`;
          } else {
            console.log('‚ùå User not authenticated');
            // For demo purposes, auto-login the demo user
            await demoLogin();
          }
        } catch (error) {
          console.error('‚ùå Authentication check failed:', error);
          // Fallback to demo login
          await demoLogin();
        }
      }

      // Demo login function (for development)
      async function demoLogin() {
        try {
          const response = await fetch('http://localhost/gaming-zone/api/auth.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify({
              action: 'login',
              email: 'iheb@example.com'
            })
          });
          
          const result = await response.json();
          console.log('üîê Demo login result:', result);
          
          if (result.success) {
            currentUser = result.user;
            console.log('‚úÖ Demo login successful:', currentUser);
            
            // Update UI
            document.querySelector('.username').textContent = currentUser.name;
            document.querySelector('.welcome-text').textContent = `Welcome back, ${currentUser.name.split(' ')[0]}!`;
          } else {
            console.error('‚ùå Demo login failed:', result.error);
            // Fallback to hardcoded user for demo
            currentUser = {
              id: 'user-001',
              name: 'Elazheri Iheb',
              email: 'iheb@example.com',
              role: 'USER'
            };
          }
        } catch (error) {
          console.error('‚ùå Demo login error:', error);
          // Fallback to hardcoded user
          currentUser = {
            id: 'user-001',
            name: 'Elazheri Iheb',
            email: 'iheb@example.com',
            role: 'USER'
          };
        }
      }

      // Force display function
      function forceDisplayGames(games) {
        console.log("üé® Force displaying games:", games.length);
        const gamesGrid = document.getElementById("gamesGrid");

        if (!gamesGrid) {
          console.error("‚ùå Games grid not found!");
          return;
        }

        // Set grid layout
        gamesGrid.style.cssText = `
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
          gap: 30px;
          margin-top: 30px;
          padding: 20px 0;
        `;

        const gamesHTML = games
          .map((game, index) => {
            console.log(`üéÆ Processing game ${index + 1}:`, game.name);
            return `
            <div class="game-card" style="
              background: rgba(248, 250, 252, 0.05);
              backdrop-filter: blur(20px);
              border: 1px solid rgba(248, 250, 252, 0.1);
              border-radius: 20px;
              overflow: hidden;
              transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
              position: relative;
              box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            " onmouseover="this.style.transform='translateY(-10px)'; this.style.boxShadow='0 25px 50px rgba(0, 0, 0, 0.3)'; this.style.borderColor='rgba(59, 130, 246, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 32px rgba(0, 0, 0, 0.1)'; this.style.borderColor='rgba(248, 250, 252, 0.1)'">
              
              <div class="game-image" style="
                position: relative;
                height: 220px;
                overflow: hidden;
                background: linear-gradient(45deg, #667eea, #764ba2);
              ">
                <img src="${
                  game.imageUrl ||
                  "https://images.unsplash.com/photo-1542751371-adc38448a05e?w=400"
                }" 
                     alt="${game.name}" 
                     style="
                       width: 100%; 
                       height: 100%; 
                       object-fit: cover;
                       transition: transform 0.3s ease;
                     "
                     onmouseover="this.style.transform='scale(1.05)'"
                     onmouseout="this.style.transform='scale(1)'"
                     onerror="this.src='https://images.unsplash.com/photo-1542751371-adc38448a05e?w=400'">
                
                <div style="
                  position: absolute;
                  top: 15px;
                  right: 15px;
                  background: rgba(0, 0, 0, 0.7);
                  color: #fbbf24;
                  padding: 6px 12px;
                  border-radius: 20px;
                  font-size: 0.8rem;
                  font-weight: 600;
                  display: flex;
                  align-items: center;
                  gap: 4px;
                ">
                  ‚≠ê ${game.averageRating || "0.0"}
                </div>
                
                <div style="
                  position: absolute;
                  bottom: 0;
                  left: 0;
                  right: 0;
                  background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
                  padding: 20px 0 10px;
                "></div>
              </div>
              
              <div class="game-info" style="padding: 25px;">
                <div style="margin-bottom: 15px;">
                  <h3 style="
                    color: #f8fafc;
                    margin: 0 0 8px 0;
                    font-size: 1.4rem;
                    font-weight: 700;
                    line-height: 1.2;
                  ">${game.name}</h3>
                  
                  <div style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    margin-bottom: 12px;
                  ">
                    <span style="
                      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                      color: white;
                      padding: 4px 12px;
                      border-radius: 15px;
                      font-size: 0.75rem;
                      font-weight: 600;
                      text-transform: uppercase;
                      letter-spacing: 0.5px;
                    ">üìÇ ${game.categoryName || "Unknown"}</span>
                  </div>
                </div>
                
                <p style="
                  color: #cbd5e1;
                  font-size: 0.9rem;
                  line-height: 1.6;
                  margin-bottom: 20px;
                  display: -webkit-box;
                  -webkit-line-clamp: 3;
                  -webkit-box-orient: vertical;
                  overflow: hidden;
                ">${
                  game.description ||
                  "Experience an amazing gaming adventure with stunning graphics and immersive gameplay."
                }</p>
                
                <div style="
                  display: flex;
                  gap: 10px;
                  margin-bottom: 20px;
                  flex-wrap: wrap;
                ">
                  ${
                    game.minAge
                      ? `<span style="
                    background: rgba(59, 130, 246, 0.15);
                    color: #93c5fd;
                    padding: 6px 14px;
                    border-radius: 20px;
                    font-size: 0.8rem;
                    font-weight: 600;
                    border: 1px solid rgba(59, 130, 246, 0.3);
                  ">üîû Age: ${game.minAge}+</span>`
                      : ""
                  }
                  
                  ${
                    game.targetGender
                      ? `<span style="
                    background: rgba(236, 72, 153, 0.15);
                    color: #f9a8d4;
                    padding: 6px 14px;
                    border-radius: 20px;
                    font-size: 0.8rem;
                    font-weight: 600;
                    border: 1px solid rgba(236, 72, 153, 0.3);
                  ">üë§ ${game.targetGender}</span>`
                      : ""
                  }
                </div>
                
                <div style="
                  display: flex;
                  gap: 12px;
                  margin-top: auto;
                ">
                  <button onclick="alert('üéÆ Launching ${
                    game.name
                  }!\\n\\nGet ready for an epic gaming experience!')" style="
                    flex: 1;
                    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                    color: white;
                    border: none;
                    padding: 14px 20px;
                    border-radius: 12px;
                    font-weight: 700;
                    font-size: 0.9rem;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 8px;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                  " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 10px 25px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    üéÆ Play Now
                  </button>
                  
                  <button onclick="alert('üìã Game Details:\\n\\nName: ${
                    game.name
                  }\\nCategory: ${game.categoryName}\\nRating: ${
              game.averageRating
            }\\nAge: ${game.minAge}+\\n\\nDescription: ${
              game.description
            }')" style="
                    background: rgba(248, 250, 252, 0.1);
                    color: #e2e8f0;
                    border: 2px solid rgba(248, 250, 252, 0.2);
                    padding: 14px 16px;
                    border-radius: 12px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                  " onmouseover="this.style.backgroundColor='rgba(248, 250, 252, 0.15)'; this.style.borderColor='rgba(59, 130, 246, 0.5)'" onmouseout="this.style.backgroundColor='rgba(248, 250, 252, 0.1)'; this.style.borderColor='rgba(248, 250, 252, 0.2)'">
                    ‚ÑπÔ∏è
                  </button>
                </div>
              </div>
            </div>
          `;
          })
          .join("");

        console.log("üìù Setting games HTML...");
        gamesGrid.innerHTML = gamesHTML;
        console.log("‚úÖ Games should now be visible with improved UI!");
      }

      // Navigation functionality
      const navItems = document.querySelectorAll('.nav-item');
      const sections = ['homeSection', 'gamesSection', 'tournamentSection', 'eventsSection'];
      
      navItems.forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          
          console.log('üîÑ Navigation clicked:', this.getAttribute('id'));
          
          // Remove active class from all nav items
          navItems.forEach(nav => nav.classList.remove('active'));
          
          // Add active class to clicked item
          this.classList.add('active');
          
          // Hide all sections
          sections.forEach(sectionId => {
            const section = document.getElementById(sectionId);
            if (section) {
              section.style.display = 'none';
            }
          });
          
          // Show target section
          const targetSection = this.getAttribute('id');
          let sectionToShow = '';
          
          switch(targetSection) {
            case 'homeLink':
              sectionToShow = 'homeSection';
              break;
            case 'gamesLink':
              sectionToShow = 'gamesSection';
              // Force games initialization
              setTimeout(() => {
                console.log('üéÆ Attempting to initialize games...');
                forceDisplayGames();
              }, 300);
              break;
            case 'tournamentsLink':
              sectionToShow = 'tournamentSection';
              // Force tournaments initialization
              setTimeout(() => {
                console.log('üèÜ Attempting to initialize tournaments...');
                loadTournamentsDirectly();
              }, 300);
              break;
            case 'eventsLink':
              sectionToShow = 'eventsSection';
              break;
          }
          
          const section = document.getElementById(sectionToShow);
          if (section) {
            section.style.display = 'block';
            console.log(`‚úÖ Switched to section: ${sectionToShow}`);
          }
        });
      });

      // Fallback function to load tournaments directly
      async function loadTournamentsDirectly() {
        console.log('üîß Loading tournaments directly...');
        
        try {
          const response = await fetch('http://localhost/gaming-zone/api/tournaments.php');
          console.log('üì° Tournament API response status:', response.status);
          
          const tournaments = await response.json();
          console.log('üì¶ Direct tournament fetch result:', tournaments);
          
          if (Array.isArray(tournaments) && tournaments.length > 0) {
            displayTournamentsDirectly(tournaments);
          } else {
            showNoTournamentsMessage();
          }
        } catch (error) {
          console.error('‚ùå Direct tournaments loading failed:', error);
          showTournamentsErrorMessage(error.message);
        }
      }

      function displayTournamentsDirectly(tournaments) {
        console.log('üé® Displaying tournaments directly...', tournaments.length);
        
        const tournamentsGrid = document.getElementById('tournamentsGrid');
        if (!tournamentsGrid) {
          console.error('‚ùå Tournaments grid not found');
          return;
        }

        // Set grid layout
        tournamentsGrid.style.cssText = `
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
          gap: 30px;
          margin-top: 30px;
          padding: 20px 0;
        `;
        
        const tournamentsHTML = tournaments.map(tournament => {
          console.log('üèÜ Processing tournament:', tournament.name);
          
          const startDate = new Date(tournament.startDate);
          const endDate = new Date(tournament.endDate);
          const now = new Date();
          const isActive = now >= startDate && now <= endDate;
          const isUpcoming = now < startDate;
          const isEnded = now > endDate;
          
          let statusBadge = '';
          let statusColor = '';
          
          if (isEnded) {
            statusBadge = 'üèÅ Ended';
            statusColor = '#ef4444';
          } else if (isActive) {
            statusBadge = 'üî• Live';
            statusColor = '#22c55e';
          } else if (isUpcoming) {
            statusBadge = 'üìÖ Upcoming';
            statusColor = '#3b82f6';
          }

          return `
            <div class="tournament-card" style="
              background: rgba(248, 250, 252, 0.05);
              backdrop-filter: blur(20px);
              border: 1px solid rgba(248, 250, 252, 0.1);
              border-radius: 20px;
              overflow: hidden;
              transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
              position: relative;
              box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            " onmouseover="this.style.transform='translateY(-10px)'; this.style.boxShadow='0 25px 50px rgba(0, 0, 0, 0.3)'; this.style.borderColor='rgba(59, 130, 246, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 32px rgba(0, 0, 0, 0.1)'; this.style.borderColor='rgba(248, 250, 252, 0.1)'">
              
              <div class="tournament-image" style="
                position: relative;
                height: 220px;
                overflow: hidden;
                background: linear-gradient(45deg, #667eea, #764ba2);
              ">
                <img src="${tournament.imageUrl || 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=400'}" 
                     alt="${tournament.name}" 
                     style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;"
                     onmouseover="this.style.transform='scale(1.05)'"
                     onmouseout="this.style.transform='scale(1)'"
                     onerror="this.src='https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=400'">
                
                <div style="
                  position: absolute;
                  top: 15px;
                  left: 15px;
                  background: ${statusColor};
                  color: white;
                  padding: 6px 12px;
                  border-radius: 20px;
                  font-size: 0.8rem;
                  font-weight: 700;
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
                ">
                  ${statusBadge}
                </div>
                
                <div style="
                  position: absolute;
                  top: 15px;
                  right: 15px;
                  background: rgba(0, 0, 0, 0.7);
                  color: #22c55e;
                  padding: 6px 12px;
                  border-radius: 20px;
                  font-size: 0.8rem;
                  font-weight: 600;
                ">
                  üí∞ $${tournament.prizePool || '0'}
                </div>
              </div>
              
              <div class="tournament-info" style="padding: 25px;">
                <h3 style="
                  color: #f8fafc;
                  margin: 0 0 12px 0;
                  font-size: 1.4rem;
                  font-weight: 700;
                  line-height: 1.2;
                ">${tournament.name}</h3>
                
                <p style="
                  color: #cbd5e1;
                  font-size: 0.9rem;
                  line-height: 1.6;
                  margin-bottom: 20px;
                  display: -webkit-box;
                  -webkit-line-clamp: 2;
                  -webkit-box-orient: vertical;
                  overflow: hidden;
                ">${tournament.description || 'Join this exciting tournament and compete with the best players!'}</p>
                
                <div style="margin-bottom: 20px;">
                  <div style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 10px;
                    color: #94a3b8;
                    font-size: 0.85rem;
                  ">
                    <span>üìÖ Start: ${startDate.toLocaleDateString()} ${startDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                  </div>
                  <div style="
                    display: flex;
                    justify-content: space-between;
                    color: #94a3b8;
                    font-size: 0.85rem;
                  ">
                    <span>üèÅ End: ${endDate.toLocaleDateString()} ${endDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                  </div>
                </div>
                
                <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 25px;
                  padding: 15px;
                  background: rgba(59, 130, 246, 0.1);
                  border-radius: 12px;
                  border: 1px solid rgba(59, 130, 246, 0.2);
                ">
                  <div style="text-align: center;">
                    <div style="color: #93c5fd; font-size: 0.8rem; margin-bottom: 4px;">Max Players</div>
                    <div style="color: #f8fafc; font-weight: 700; font-size: 1.1rem;">${tournament.maxParticipants || 50}</div>
                  </div>
                  <div style="text-align: center;">
                    <div style="color: #93c5fd; font-size: 0.8rem; margin-bottom: 4px;">Prize Pool</div>
                    <div style="color: #22c55e; font-weight: 700; font-size: 1.1rem;">$${tournament.prizePool || '0'}</div>
                  </div>
                </div>
                
                <button onclick="openTournamentRegistrationModal('${tournament.id}', '${tournament.name}')" 
                        ${isEnded ? 'disabled' : ''} 
                        style="
                  width: 100%;
                  background: ${isEnded ? 'rgba(156, 163, 175, 0.5)' : 'linear-gradient(135deg, #3b82f6, #1d4ed8)'};
                  color: white;
                  border: none;
                  padding: 16px 24px;
                  border-radius: 12px;
                  font-weight: 700;
                  font-size: 1rem;
                  cursor: ${isEnded ? 'not-allowed' : 'pointer'};
                  transition: all 0.3s ease;
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
                " ${!isEnded ? `onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 10px 25px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"` : ''}>
                  ${isEnded ? 'üèÅ Tournament Ended' : 'üéÆ Register Now'}
                </button>
              </div>
            </div>
          `;
        }).join('');
        
        tournamentsGrid.innerHTML = tournamentsHTML;
        console.log(`‚úÖ Successfully displayed ${tournaments.length} tournaments`);
      }

      function showNoTournamentsMessage() {
        const tournamentsGrid = document.getElementById('tournamentsGrid');
        if (tournamentsGrid) {
          tournamentsGrid.innerHTML = `
            <div style="text-align: center; padding: 60px 20px; color: #94a3b8; grid-column: 1 / -1;">
              <i class="fas fa-trophy" style="font-size: 4rem; color: #475569; margin-bottom: 20px;"></i>
              <h3 style="font-size: 1.5rem; color: #f8fafc; margin-bottom: 12px;">No tournaments found</h3>
              <p>No tournaments available in the database</p>
            </div>
          `;
        }
      }

      function showTournamentsErrorMessage(message) {
        const tournamentsGrid = document.getElementById('tournamentsGrid');
        if (tournamentsGrid) {
          tournamentsGrid.innerHTML = `
            <div style="text-align: center; padding: 60px 20px; color: #94a3b8; grid-column: 1 / -1;">
              <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: #475569; margin-bottom: 20px;"></i>
              <h3 style="font-size: 1.5rem; color: #f8fafc; margin-bottom: 12px;">Error Loading Tournaments</h3>
              <p>${message}</p>
              <button onclick="loadTournamentsDirectly()" style="
                background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 600;
                margin-top: 20px;
              ">
                <i class="fas fa-refresh"></i>
                Try Again
              </button>
            </div>
          `;
        }
      }

      // Global functions for tournament registration
      let currentTournamentId = '';

      window.openTournamentRegistrationModal = function(tournamentId, tournamentName) {
        console.log('üéØ Opening registration modal for tournament:', tournamentId);
        
        // Check if user is authenticated
        if (!currentUser || !currentUser.id) {
          alert('‚ö†Ô∏è Please login to register for tournaments');
          return;
        }
        
        currentTournamentId = tournamentId;
        
        // Set tournament data in modal
        document.getElementById('tournamentTitle').textContent = tournamentName;
        
        // Pre-fill user data from authenticated session
        document.getElementById('regUsername').value = currentUser.name;
        document.getElementById('contactEmail').value = currentUser.email;
        
        // Show modal
        const modal = document.getElementById('registrationModal');
        if (modal) {
          modal.style.display = 'flex';
        }
      };

      window.closeModal = function() {
        const modal = document.getElementById('registrationModal');
        if (modal) {
          modal.style.display = 'none';
          
          // Reset form
          const form = document.getElementById('registrationForm');
          if (form) {
            form.reset();
          }
        }
      };

      window.handleRegistration = async function(event) {
        event.preventDefault();
        console.log('üìù Handling registration form submission...');
        
        // Check authentication again before submission
        if (!currentUser || !currentUser.id) {
          alert('‚ö†Ô∏è Authentication required. Please login first.');
          return;
        }
        
        const formData = new FormData(event.target);
        const registrationData = {
          userId: currentUser.id, // Get from authenticated session
          tournamentId: currentTournamentId,
          username: formData.get('username'),
          email: formData.get('email'),
          teamName: formData.get('teamName')
        };
        
        console.log('üì§ Sending registration data:', registrationData);
        
        // Disable submit button to prevent double submission
        const submitBtn = event.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.disabled = true;
        submitBtn.textContent = '‚è≥ Registering...';
        
        try {
          const response = await fetch('http://localhost/gaming-zone/api/tournament-registration.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            credentials: 'include', // Include session cookies
            body: JSON.stringify(registrationData)
          });

          console.log('üì° Response status:', response.status);
          console.log('üì° Response headers:', response.headers.get('content-type'));

          // Check if response is actually JSON
          const contentType = response.headers.get('content-type');
          if (!contentType || !contentType.includes('application/json')) {
            const textResponse = await response.text();
            console.error('‚ùå Non-JSON response received:', textResponse);
            throw new Error('Server returned non-JSON response. Check server logs.');
          }

          const result = await response.json();
          console.log('üì• Registration response:', result);

          if (result.success) {
            alert('üéâ Registration successful!\n\nYou have been registered for the tournament. Check your email for confirmation.');
            closeModal();
          } else {
            throw new Error(result.error || 'Registration failed');
          }
        } catch (error) {
          console.error('‚ùå Registration failed:', error);
          alert('‚ùå Registration failed: ' + error.message);
        } finally {
          // Re-enable submit button
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        }
      };

      // Handle Logout - Fixed version
      async function handleLogout() {
        if (confirm('üö™ Are you sure you want to logout?')) {
          console.log('üîÑ Starting logout process...');
          
          // Show loading state
          const logoutBtn = document.querySelector('.logout-btn');
          const originalHTML = logoutBtn.innerHTML;
          logoutBtn.disabled = true;
          logoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>Logging out...</span>';
          
          try {
            // Call logout API
            const response = await fetch('http://localhost/gaming-zone/api/auth.php', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              credentials: 'include', // Include cookies for session cleanup
              body: JSON.stringify({ action: 'logout' })
            });
            
            console.log('üì° Logout response status:', response.status);
            
            const result = await response.json();
            console.log('üì• Logout response:', result);
            
            if (result.success) {
              console.log('‚úÖ Server logout successful');
              
              // Clear all local storage
              localStorage.clear();
              sessionStorage.clear();
              console.log('üßπ Local storage cleared');
              
              // Clear all cookies manually
              clearAllCookies();
              console.log('üç™ Cookies cleared');
              
              // Reset current user
              currentUser = null;
              
              // Show success message
              alert('üëã Logged out successfully!\n\nRedirecting to homepage...');
              
              // Force redirect to root after short delay
              setTimeout(() => {
                console.log('üîÑ Redirecting to homepage...');
                window.location.href = '/gaming-zone/';
                
                // Fallback: Force refresh if redirect doesn't work
                setTimeout(() => {
                  window.location.replace('/gaming-zone/');
                }, 1000);
              }, 1000);
              
            } else {
              throw new Error(result.error || 'Logout failed on server');
            }
          } catch (error) {
            console.error('‚ùå Logout error:', error);
            
            // Even if server logout fails, clean local data and redirect
            console.log('‚ö†Ô∏è Server logout failed, but cleaning local data anyway...');
            
            localStorage.clear();
            sessionStorage.clear();
            clearAllCookies();
            currentUser = null;
            
            alert('‚ö†Ô∏è Logout completed with warnings.\n\nRedirecting to homepage...');
            
            setTimeout(() => {
              window.location.href = '/gaming-zone/';
              
              // Fallback
              setTimeout(() => {
                window.location.replace('/gaming-zone/');
              }, 1000);
            }, 1000);
          } finally {
            // Reset button state (in case redirect is delayed)
            setTimeout(() => {
              if (logoutBtn) {
                logoutBtn.disabled = false;
                logoutBtn.innerHTML = originalHTML;
              }
            }, 500);
          }
        }
      }

      // Function to clear all cookies
      function clearAllCookies() {
        console.log('üç™ Clearing all cookies...');
        
        // Get all cookies
        const cookies = document.cookie.split(";");
        
        // Clear each cookie
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i];
          const eqPos = cookie.indexOf("=");
          const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
          
          if (name) {
            // Clear cookie for current path
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;`;
            
            // Clear cookie for root path
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/gaming-zone/;`;
            
            // Clear cookie for current domain
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=${window.location.hostname};`;
            
            console.log(`üóëÔ∏è Cleared cookie: ${name}`);
          }
        }
        
        // Specifically clear known auth cookies
        const authCookies = ['auth_token', 'user_id', 'session_id', 'PHPSESSID'];
        authCookies.forEach(cookieName => {
          document.cookie = `${cookieName}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;`;
          document.cookie = `${cookieName}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/gaming-zone/;`;
          document.cookie = `${cookieName}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=${window.location.hostname};`;
        });
        
        console.log('‚úÖ All cookies cleared');
      }

      // Enhanced function to clear specific cookie
      function deleteCookie(name) {
        // Clear for multiple paths and domains
        const paths = ['/', '/gaming-zone/', '/gaming-zone/user-interface/'];
        const domains = [window.location.hostname, `.${window.location.hostname}`];
        
        paths.forEach(path => {
          document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=${path};`;
          
          domains.forEach(domain => {
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=${path};domain=${domain};`;
          });
        });
      }

      // Initialize Lucide icons
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    </script>
  </body>
</html>
